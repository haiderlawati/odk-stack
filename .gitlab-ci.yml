stages:
    - services
    - triggers

# POSTGRES DATABASE

start_database:
    stage: services
    script:
        - docker-compose -f docker-compose.ci.yml up -d postgres-db

# RABBITMQ MESSAGE BROKER

start_rabbitmq:
    stage: services
    script:
        - docker-compose -f docker-compose.ci.yml up -d rabbitmq

# FASTAPI SERVER

trigger_server:
    stage: triggers
    trigger:
        include: odk-api/.gitlab-ci.yml
    rules:
        - changes:
            - docker-compose.ci.yml
            - odk-api/**/*    

# VUE PWA

# build_app:
#     stage: build
#     script:
#         - docker-compose -f docker-compose.ci.yml stop vue-pwa
#         - docker-compose -f docker-compose.ci.yml build vue-pwa
#     rules:
#         - changes:
#             - docker-compose.yml
#             - pwa/**/*

# deploy_app:
#     stage: deploy
#     needs: build_app
#     script:
#         - docker-compose -f docker-compose.ci.yml up -d vue-pwa