version: '3'

services:

  app:
    container_name: odk-app
    build: ./odk-app
    ports:
      - "8000:80"

  api:
    container_name: odk-api
    build: ./odk-api
    env_file:
      - ./odk-api/.env
      - ./odk-api/.docker.env
    ports:
      - "8080:80"

  db:
    container_name: odk-db
    build: ./postgres_dockerfiles
    environment:
      - PGDATA=/pgdata
      - POSTGRES_USER=db_user
      - POSTGRES_PASSWORD=db_password
    ports:
      - "5432:5432"
    # volumes:
    #   - ./pgdata:/pgdata

  rmq:
    container_name: odk-rmq
    image: rabbitmq:3-management
    environment:
      - RABBITMQ_DEFAULT_USER=rmq_user
      - RABBITMQ_DEFAULT_PASS=rmq_password
    ports:
       - "8081:8080"
       - "5672:5672"
       - "15672:15672"
